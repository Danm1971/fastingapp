<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<title>Faste-tracker v25 (Simple)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
:root {
--bg: #050816;
--bg-card: #0d1220;
--accent: #ff4b91;
--accent-soft: #ffc7dd;
--accent-2: #26c6da;
--accent-3: #ffca28;
--text: #f5f5f7;
--text-soft: #a0aec0;
--danger: #ff1744;
--ok: #00e676;
--border-subtle: #20263a;
}

* {
box-sizing: border-box;
font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
"SF Pro Text", "Segoe UI", sans-serif;
}

body {
margin: 0;
padding: 0;
background: radial-gradient(circle at top, #181a3a, #050816 55%);
color: var(--text);
display: flex;
justify-content: center;
min-height: 100vh;
}

.page {
width: 100%;
max-width: 960px;
padding: 12px;
}

h1 {
margin: 0 0 6px;
font-size: 1.4rem;
display: flex;
align-items: center;
gap: 8px;
}

h1 span.logo-pill {
display: inline-flex;
align-items: center;
justify-content: center;
width: 30px;
height: 30px;
border-radius: 999px;
background: radial-gradient(circle at 30% 30%, #ff9a9e, #ff4b91);
color: #fff;
font-weight: 700;
font-size: 0.9rem;
}

.subtitle {
font-size: 0.8rem;
color: var(--text-soft);
margin-bottom: 10px;
}

.layout {
display: grid;
gap: 10px;
}

@media (min-width: 820px) {
.layout {
grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
align-items: flex-start;
}
}

.card {
background: linear-gradient(145deg, #0b1020, #11172a);
border-radius: 14px;
padding: 10px 10px 12px;
border: 1px solid var(--border-subtle);
box-shadow: 0 18px 32px rgba(0, 0, 0, 0.5);
}

.card h2 {
margin: 0 0 6px;
font-size: 0.95rem;
display: flex;
align-items: center;
gap: 6px;
}

.card h2 span.tag {
font-size: 0.65rem;
padding: 2px 8px;
border-radius: 999px;
border: 1px solid rgba(255, 255, 255, 0.08);
color: var(--text-soft);
}

.top-row {
display: flex;
flex-wrap: wrap;
gap: 10px;
align-items: stretch;
}

.timer-block {
flex: 2 1 160px;
display: flex;
flex-direction: column;
gap: 2px;
}

.timer-main {
font-variant-numeric: tabular-nums;
font-size: 1.9rem;
font-weight: 600;
letter-spacing: 0.04em;
}

.timer-label {
font-size: 0.75rem;
color: var(--text-soft);
}

.timer-secondary {
font-variant-numeric: tabular-nums;
font-size: 1.1rem;
margin-top: 2px;
}

.mini-label {
font-size: 0.7rem;
color: var(--text-soft);
}

.top-meters {
flex: 2 1 170px;
display: flex;
flex-direction: column;
gap: 6px;
align-items: center;
justify-content: center;
}

/* SPEEDOMETER */
.speedometer {
width: 150px;
height: 80px;
position: relative;
}

.speedometer-arc {
position: absolute;
bottom: -75px;
left: 0;
right: 0;
margin: 0 auto;
width: 150px;
height: 150px;
border-radius: 999px;
background: conic-gradient(
from 180deg,
#22c55e 0deg,
#22c55e 50deg,
#facc15 50deg,
#facc15 110deg,
#ef4444 110deg,
#ef4444 180deg,
#020617 180deg,
#020617 360deg
);
border: 2px solid #020617;
}

.speedometer-center {
position: absolute;
bottom: 0;
left: 50%;
width: 12px;
height: 12px;
border-radius: 50%;
background: #020617;
border: 2px solid #e5e7eb;
transform: translateX(-50%);
box-shadow: 0 0 6px rgba(248, 250, 252, 0.8);
}

.speedometer-needle {
position: absolute;
bottom: 0;
left: 50%;
width: 2px;
height: 70px;
background: #e5e7eb;
transform-origin: bottom center;
transform: rotate(0deg);
box-shadow: 0 0 6px rgba(248, 250, 252, 0.8);
}

.speedometer-labels {
position: absolute;
top: 0;
left: 0;
right: 0;
display: flex;
justify-content: space-between;
padding: 0 6px;
font-size: 0.65rem;
color: var(--text-soft);
}

.speedometer-text {
margin-top: 4px;
font-size: 0.72rem;
text-align: center;
color: var(--text-soft);
}

/* V√ÜGTL√ÖD */
.weight-lod {
position: relative;
width: 70px;
height: 70px;
margin-top: 4px;
}

.weight-lod-handle {
position: absolute;
top: 2px;
left: 50%;
width: 22px;
height: 12px;
border-radius: 999px;
border: 2px solid #fef3c7;
transform: translateX(-50%);
background: rgba(15, 23, 42, 0.9);
}

.weight-lod-body {
position: absolute;
bottom: 0;
left: 50%;
width: 52px;
height: 52px;
transform: translateX(-50%);
border-radius: 8px;
background: radial-gradient(circle at 30% 20%, #f97316, #b91c1c);
box-shadow: 0 6px 12px rgba(248, 113, 113, 0.6);
display: flex;
align-items: center;
justify-content: center;
flex-direction: column;
color: #fefce8;
font-size: 0.7rem;
font-variant-numeric: tabular-nums;
}

.weight-lod-body strong {
font-size: 0.9rem;
}

.weight-lod-body span {
font-size: 0.65rem;
opacity: 0.9;
}

.phase-strip {
margin-top: 8px;
padding: 6px 8px 8px;
border-radius: 12px;
background: radial-gradient(circle at top left, #312258, #0b101f);
border: 1px solid rgba(255, 255, 255, 0.06);
}

.phase-strip-header {
display: flex;
justify-content: space-between;
align-items: center;
gap: 6px;
margin-bottom: 4px;
font-size: 0.75rem;
}

.phase-strip-header span.main-phase {
display: inline-flex;
align-items: center;
gap: 4px;
}

.phase-strip-header span.main-phase-emoji {
font-size: 1rem;
}

.phase-strip-header span.phase-chip {
font-size: 0.65rem;
padding: 2px 8px;
border-radius: 999px;
background: rgba(15, 23, 42, 0.8);
border: 1px solid rgba(148, 163, 184, 0.55);
}

.phase-bar {
position: relative;
height: 12px;
border-radius: 999px;
background: linear-gradient(
90deg,
#4b5563 0%,
#22c55e 45%,
#22c55e 60%,
#f97316 80%,
#ef4444 100%
);
overflow: hidden;
}

.phase-bar-fill {
position: absolute;
top: 0;
left: 0;
bottom: 0;
background: rgba(15, 23, 42, 0.9);
transform-origin: left;
transform: scaleX(0);
transition: transform 0.25s ease-out;
}

.phase-bar-marker {
position: absolute;
top: -2px;
width: 2px;
bottom: -2px;
background: #f9fafb;
box-shadow: 0 0 6px rgba(248, 250, 252, 0.8);
}

.phase-strip-footer {
margin-top: 4px;
font-size: 0.65rem;
color: var(--text-soft);
display: flex;
justify-content: space-between;
}

.fat-grid {
display: grid;
grid-template-columns: repeat(4, minmax(0, 1fr));
gap: 4px;
margin-top: 6px;
}

.fat-pill {
text-align: center;
border-radius: 999px;
padding: 3px 0;
font-size: 0.65rem;
background: rgba(15, 23, 42, 0.9);
border: 1px solid rgba(148, 163, 184, 0.3);
color: var(--text-soft);
}

.fat-pill span.val {
display: block;
font-variant-numeric: tabular-nums;
font-size: 0.78rem;
color: var(--text);
}

.fat-pill.carb {
border-color: #fb923c;
background: rgba(251, 146, 60, 0.08);
}
.fat-pill.fat {
border-color: #4ade80;
background: rgba(34, 197, 94, 0.08);
}
.fat-pill.muscle {
border-color: #f472b6;
background: rgba(236, 72, 153, 0.08);
}
.fat-pill.bone {
border-color: #38bdf8;
background: rgba(56, 189, 248, 0.08);
}

.medal-row {
margin-top: 6px;
display: flex;
justify-content: space-between;
align-items: center;
font-size: 0.75rem;
}

.medal-main {
display: inline-flex;
align-items: center;
gap: 6px;
}

.medal-emoji {
font-size: 1.2rem;
}

.medal-title {
font-size: 0.78rem;
}

.autofagi-tag {
display: inline-flex;
align-items: center;
gap: 6px;
font-size: 0.7rem;
margin-top: 4px;
padding: 3px 8px;
border-radius: 999px;
background: rgba(56, 189, 248, 0.1);
border: 1px solid rgba(56, 189, 248, 0.65);
color: #e0f2fe;
}

.tiny-note {
font-size: 0.65rem;
color: var(--text-soft);
margin-top: 4px;
}

/* H√òJRE SIDE */

.grid-2 {
display: grid;
gap: 6px;
}

@media (min-width: 600px) {
.grid-2 {
grid-template-columns: repeat(2, minmax(0, 1fr));
}
}

.field {
display: flex;
flex-direction: column;
gap: 3px;
margin-bottom: 4px;
}

.field label {
font-size: 0.75rem;
color: var(--text-soft);
}

.field input,
.field select {
border-radius: 999px;
border: 1px solid rgba(255, 255, 255, 0.14);
background: rgba(0, 0, 0, 0.2);
color: var(--text);
padding: 5px 10px;
font-size: 0.8rem;
outline: none;
}

.field input::placeholder {
color: #5c6477;
}

.pill-stat {
background: rgba(0, 0, 0, 0.35);
border-radius: 12px;
padding: 6px 8px;
display: flex;
justify-content: space-between;
align-items: baseline;
margin-top: 3px;
border: 1px solid rgba(255, 255, 255, 0.04);
}

.pill-stat-label {
font-size: 0.7rem;
color: var(--text-soft);
}

.pill-stat-value {
font-variant-numeric: tabular-nums;
font-size: 0.9rem;
}

.pill-stat-value strong {
font-weight: 600;
color: var(--accent-soft);
}

.btn-row {
display: flex;
flex-wrap: wrap;
gap: 6px;
margin: 6px 0 0;
}

button {
border-radius: 999px;
border: none;
cursor: pointer;
font-size: 0.8rem;
padding: 6px 12px;
display: inline-flex;
align-items: center;
gap: 6px;
background: #22263b;
color: var(--text);
transition: transform 0.07s ease, box-shadow 0.07s ease,
background 0.15s ease;
}

button.primary {
background: linear-gradient(135deg, #ff4b91, #ff7b54);
color: #fff;
box-shadow: 0 8px 16px rgba(255, 75, 145, 0.45);
}

button.danger {
background: rgba(255, 53, 94, 0.08);
color: #ff8a80;
border: 1px solid rgba(255, 82, 82, 0.4);
}

button.secondary {
background: rgba(144, 202, 249, 0.12);
color: #e3f2fd;
border: 1px solid rgba(144, 202, 249, 0.5);
}

button:active {
transform: translateY(1px) scale(0.99);
box-shadow: none;
}

.disclaimer {
margin-top: 8px;
font-size: 0.65rem;
color: var(--text-soft);
}
</style>
</head>
<body>
<div class="page">
<h1>
<span class="logo-pill">F</span>
Faste-tracker
</h1>
<div class="subtitle">
Start n√•r du tager sidste bid mad ‚Äì appen husker dig, ogs√• n√•r du lukker den.
</div>

<div class="layout">
<!-- VENSTRE: GRAFIK + STATUS -->
<div class="card">
<h2>
Faste-status
<span class="tag" id="phaseTag">Ikke startet</span>
</h2>

<div class="top-row">
<div class="timer-block">
<div class="timer-main" id="realTimer">00:00:00</div>
<div class="timer-label">Reel faste</div>
<div class="timer-secondary" id="effectiveTimer">00:00:00</div>
<div class="mini-label">Effektiv faste (sport/refeed)</div>
</div>

<div class="top-meters">
<!-- SPEEDOMETER -->
<div class="speedometer">
<div class="speedometer-arc"></div>
<div class="speedometer-needle" id="speedNeedle"></div>
<div class="speedometer-center"></div>
<div class="speedometer-labels">
<span>Lav</span>
<span>Midt</span>
<span>Max</span>
</div>
</div>
<div class="speedometer-text" id="speedText">
Faste-hastighed
</div>

<!-- V√ÜGTL√ÖD -->
<div class="weight-lod" id="weightLod">
<div class="weight-lod-handle"></div>
<div class="weight-lod-body">
<strong id="weightLossGrams">0</strong>
<span>g tabt</span>
</div>
</div>
</div>
</div>

<div class="phase-strip">
<div class="phase-strip-header">
<span class="main-phase">
<span class="main-phase-emoji" id="phaseEmoji">‚è∏Ô∏è</span>
<span id="phaseTitle">Ingen faste</span>
</span>
<span class="phase-chip" id="timeToOptimalLabel">‚Äì</span>
</div>
<div class="phase-bar">
<div class="phase-bar-fill" id="phaseBarFill"></div>
<div class="phase-bar-marker" id="phaseMarker"></div>
</div>
<div class="phase-strip-footer">
<span>Start</span>
<span>P√• vej</span>
<span>Optimal</span>
<span>Aftager</span>
</div>
</div>

<div class="fat-grid">
<div class="fat-pill carb">
Kulhydrat
<span class="val" id="carbPercent">‚Äì%</span>
</div>
<div class="fat-pill fat">
Fedt
<span class="val" id="fatPercent">‚Äì%</span>
</div>
<div class="fat-pill muscle">
Muskler
<span class="val" id="musclePercent">‚Äì%</span>
</div>
<div class="fat-pill bone">
Knogle
<span class="val" id="bonePercent">‚Äì%</span>
</div>
</div>

<div class="medal-row">
<div class="medal-main">
<span class="medal-emoji" id="medalEmoji">‚¨ú</span>
<span class="medal-title" id="medalTitle">Ingen medalje</span>
</div>
<span class="phase-chip" id="phaseShort">
Klar til start
</span>
</div>

<div
class="autofagi-tag"
id="autofagiTag"
style="display: none; margin-top: 6px"
>
üß¨ Autofagi aktiv (model).
</div>

<div class="tiny-note">
Modellen giver kun grove bud p√• v√¶gttab og fordeling af energi ‚Äì ikke medicinske anbefalinger.
</div>
</div>

<!-- H√òJRE: PROFIL + STYRING -->
<div class="card">
<h2>
Profil & styring
<span class="tag">Gemmes lokalt</span>
</h2>

<div class="grid-2">
<div class="field">
<label>Aldersgruppe</label>
<select id="ageGroup">
<option value="18-29">18‚Äì29</option>
<option value="30-39">30‚Äì39</option>
<option value="40-49" selected>40‚Äì49</option>
<option value="50-59">50‚Äì59</option>
<option value="60-69">60‚Äì69</option>
<option value="70+">70+</option>
</select>
</div>
<div class="field">
<label>K√∏n</label>
<select id="gender">
<option value="mand" selected>Mand</option>
<option value="kvinde">Kvinde</option>
<option value="andet">Andet</option>
</select>
</div>
</div>

<div class="grid-2">
<div class="field">
<label>V√¶gt (kg)</label>
<input type="number" id="weight" min="30" max="250" step="0.5" placeholder="fx 85" />
</div>
<div class="field">
<label>Muskel-niveau</label>
<select id="muscleLevel">
<option value="lav">Lav</option>
<option value="normal" selected>Normal</option>
<option value="muskul√∏s">Muskul√∏s</option>
<option value="atletisk">Atletisk</option>
</select>
</div>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Dagligt kaloriebehov (model)</div>
<div class="pill-stat-value">
<strong id="dailyCalories">‚Äì</strong> kcal
</div>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Basisforbr√¶nding pr. time</div>
<div class="pill-stat-value">
<strong id="bmrHour">‚Äì</strong> kcal/t
</div>
</div>

<div class="field" style="margin-top:6px;">
<label>Timer siden sidste m√•ltid</label>
<input type="number" id="preHours" min="0" step="0.25" placeholder="fx 3" />
</div>

<div class="btn-row">
<button class="primary" id="startBtn">‚ñ∂Ô∏è Start / forts√¶t</button>
<button class="danger" id="resetBtn">üîÅ Nulstil</button>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Effektiv faste (timer)</div>
<div class="pill-stat-value">
<strong id="effectiveHoursLabel">0,0</strong>
</div>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Reel faste (timer)</div>
<div class="pill-stat-value">
<strong id="realHoursLabel">0,0</strong>
</div>
</div>

<hr style="border:none;border-top:1px solid rgba(148,163,184,0.35);margin:8px 0" />

<h2 style="font-size:0.9rem;margin-top:0;">Aktivitet</h2>

<div class="field">
<label>Kalorier fra sport</label>
<input type="number" id="activityCalories" min="0" step="10" placeholder="fx 400" />
</div>
<div class="btn-row">
<button class="secondary" id="addActivityBtn">üí™ Tilf√∏j</button>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Aktivitet i denne faste</div>
<div class="pill-stat-value">
<strong id="totalActivityCalories">0</strong> kcal
</div>
</div>

<hr style="border:none;border-top:1px solid rgba(148,163,184,0.35);margin:8px 0" />

<h2 style="font-size:0.9rem;margin-top:0;">Refeed</h2>

<div class="field">
<label>Kalorier i lille m√•ltid</label>
<input type="number" id="refeedCalories" min="0" step="10" placeholder="fx 300" />
</div>
<div class="btn-row">
<button class="secondary" id="applyRefeedBtn">üçΩÔ∏è Brug refeed</button>
</div>

<div class="pill-stat">
<div class="pill-stat-label">Refeed i denne faste</div>
<div class="pill-stat-value">
<strong id="totalRefeedCalories">0</strong> kcal
</div>
</div>

<div class="disclaimer">
Kun til motivation ‚Äì tal er modeller, ikke medicinske r√•d.
</div>
</div>
</div>
</div>

<script>
const STORAGE_KEY = "fastingAppState_v25_simple";

const state = {
profile: {
ageGroup: "40-49",
gender: "mand",
weight: null,
muscleLevel: "normal"
},
startTime: null,
manualOffsetHours: 0,
isRunning: false,
totalActivityCalories: 0,
totalRefeedCalories: 0
};

let timerId = null;

function saveState() {
try {
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
} catch (e) {}
}

function loadState() {
try {
const raw = localStorage.getItem(STORAGE_KEY);
if (!raw) return;
const saved = JSON.parse(raw);
if (!saved || typeof saved !== "object") return;
if (saved.profile) {
state.profile = { ...state.profile, ...saved.profile };
}
if (typeof saved.startTime === "number") state.startTime = saved.startTime;
if (typeof saved.manualOffsetHours === "number") state.manualOffsetHours = saved.manualOffsetHours;
if (typeof saved.isRunning === "boolean") state.isRunning = saved.isRunning;
if (typeof saved.totalActivityCalories === "number") state.totalActivityCalories = saved.totalActivityCalories;
if (typeof saved.totalRefeedCalories === "number") state.totalRefeedCalories = saved.totalRefeedCalories;
} catch (e) {}
}

function formatHmsFromHours(hours) {
const totalSeconds = Math.max(0, Math.round(hours * 3600));
const h = Math.floor(totalSeconds / 3600);
const m = Math.floor((totalSeconds % 3600) / 60);
const s = totalSeconds % 60;
const pad = (n) => (n < 10 ? "0" + n : "" + n);
return `${pad(h)}:${pad(m)}:${pad(s)}`;
}

function estimateDailyCalories(weightKg, gender, ageGroup, muscleLevel) {
if (!weightKg) return null;
let factor = gender === "kvinde" ? 22 : 24;

if (ageGroup === "60-69") factor -= 1;
if (ageGroup === "70+") factor -= 2;
if (ageGroup === "18-29") factor += 1;
if (ageGroup === "30-39") factor += 0.5;

let base = weightKg * factor;
let extra = 0;

switch (muscleLevel) {
case "lav":
extra = -150;
break;
case "normal":
extra = 0;
break;
case "muskul√∏s":
extra = 350;
break;
case "atletisk":
extra = 550;
break;
}

let total = base + extra;
const minReasonable = weightKg * 18;
if (total < minReasonable) total = minReasonable;
return Math.round(total);
}

function getBmrPerHour() {
const weight = parseFloat(document.getElementById("weight").value) || null;
const gender = document.getElementById("gender").value;
const ageGroup = document.getElementById("ageGroup").value;
const muscleLevel = document.getElementById("muscleLevel").value;
const daily = estimateDailyCalories(weight, gender, ageGroup, muscleLevel);
if (!daily) return null;
return daily / 24;
}

function getPhaseInfo(effHours) {
if (effHours <= 0) {
return { tag: "Ikke startet", title: "Ingen faste", emoji: "‚è∏Ô∏è", progress: 0, short: "Klar til start" };
}
if (effHours < 4) {
return { tag: "Lav", title: "Indledning", emoji: "üü°", progress: effHours / 16, short: "P√• vej" };
} else if (effHours < 12) {
return { tag: "P√• vej", title: "Mere fedt", emoji: "üü†", progress: Math.min(0.6, effHours / 16), short: "P√• vej" };
} else if (effHours < 20) {
return { tag: "H√∏j", title: "H√∏j fedtforbr√¶nding", emoji: "üü¢", progress: Math.min(0.85, effHours / 24), short: "H√∏j" };
} else if (effHours < 28) {
return { tag: "Optimal", title: "Optimal zone", emoji: "üíé", progress: Math.min(1, effHours / 24), short: "Optimal" };
} else if (effHours < 36) {
return { tag: "Over", title: "Over optimal", emoji: "üü†", progress: 0.9, short: "Aftager" };
} else {
return { tag: "Advarsel", title: "Meget lang faste", emoji: "‚ö†Ô∏è", progress: 1, short: "Pas p√•" };
}
}

function getFuelMix(effHours) {
let carb = 0, fat = 0, muscle = 0, bone = 0;
if (effHours <= 0) {
carb = 50; fat = 50;
} else if (effHours < 4) {
carb = 90; fat = 10;
} else if (effHours < 12) {
const t = (effHours - 4) / 8;
carb = Math.round(90 - 50 * t);
fat = Math.round(10 + 50 * t);
} else if (effHours < 24) {
const t = (effHours - 12) / 12;
carb = Math.round(40 - 20 * t);
fat = Math.round(60 + 15 * t);
muscle = Math.round(0 + 5 * t);
} else if (effHours < 36) {
const t = (effHours - 24) / 12;
carb = Math.round(20 - 10 * t);
fat = Math.round(75 - 5 * t);
muscle = Math.round(5 + 10 * t);
bone = Math.round(0 + 5 * t);
} else {
carb = 10; fat = 60; muscle = 20; bone = 10;
}
const sum = carb + fat + muscle + bone;
if (sum > 0) {
carb = Math.round((carb / sum) * 100);
fat = Math.round((fat / sum) * 100);
muscle = Math.round((muscle / sum) * 100);
bone = 100 - carb - fat - muscle;
}
return { carb, fat, muscle, bone };
}

function getMedal(effHours) {
if (effHours < 12) return { emoji: "‚¨ú", title: "Ingen medalje" };
if (effHours < 16) return { emoji: "ü•â", title: "Bronze" };
if (effHours < 22) return { emoji: "ü•à", title: "S√∏lv" };
if (effHours < 30) return { emoji: "ü•á", title: "Guld" };
return { emoji: "üèÜ", title: "Ekstrem" };
}

const realTimerEl = document.getElementById("realTimer");
const effectiveTimerEl = document.getElementById("effectiveTimer");
const phaseTagEl = document.getElementById("phaseTag");
const phaseTitleEl = document.getElementById("phaseTitle");
const phaseEmojiEl = document.getElementById("phaseEmoji");
const phaseBarFillEl = document.getElementById("phaseBarFill");
const phaseMarkerEl = document.getElementById("phaseMarker");
const timeToOptimalLabelEl = document.getElementById("timeToOptimalLabel");
const speedNeedleEl = document.getElementById("speedNeedle");
const speedTextEl = document.getElementById("speedText");
const weightLossGramsEl = document.getElementById("weightLossGrams");
const medalEmojiEl = document.getElementById("medalEmoji");
const medalTitleEl = document.getElementById("medalTitle");
const phaseShortEl = document.getElementById("phaseShort");
const autofagiTagEl = document.getElementById("autofagiTag");
const carbPercentEl = document.getElementById("carbPercent");
const fatPercentEl = document.getElementById("fatPercent");
const musclePercentEl = document.getElementById("musclePercent");
const bonePercentEl = document.getElementById("bonePercent");

const ageGroupEl = document.getElementById("ageGroup");
const genderEl = document.getElementById("gender");
const weightEl = document.getElementById("weight");
const muscleLevelEl = document.getElementById("muscleLevel");
const dailyCaloriesEl = document.getElementById("dailyCalories");
const bmrHourEl = document.getElementById("bmrHour");
const preHoursEl = document.getElementById("preHours");
const startBtnEl = document.getElementById("startBtn");
const resetBtnEl = document.getElementById("resetBtn");
const effectiveHoursLabelEl = document.getElementById("effectiveHoursLabel");
const realHoursLabelEl = document.getElementById("realHoursLabel");
const activityCaloriesEl = document.getElementById("activityCalories");
const addActivityBtnEl = document.getElementById("addActivityBtn");
const totalActivityCaloriesEl = document.getElementById("totalActivityCalories");
const refeedCaloriesEl = document.getElementById("refeedCalories");
const applyRefeedBtnEl = document.getElementById("applyRefeedBtn");
const totalRefeedCaloriesEl = document.getElementById("totalRefeedCalories");

function updateProfileUI() {
ageGroupEl.value = state.profile.ageGroup || "40-49";
genderEl.value = state.profile.gender || "mand";
muscleLevelEl.value = state.profile.muscleLevel || "normal";
if (state.profile.weight != null) weightEl.value = state.profile.weight;
const weight = parseFloat(weightEl.value) || null;
const daily = estimateDailyCalories(
weight,
genderEl.value,
ageGroupEl.value,
muscleLevelEl.value
);
if (daily) {
dailyCaloriesEl.textContent = daily.toFixed(0);
bmrHourEl.textContent = (daily / 24).toFixed(0);
} else {
dailyCaloriesEl.textContent = "‚Äì";
bmrHourEl.textContent = "‚Äì";
}
totalActivityCaloriesEl.textContent = state.totalActivityCalories.toFixed(0);
totalRefeedCaloriesEl.textContent = state.totalRefeedCalories.toFixed(0);
}

function computeTimes() {
if (!state.startTime) {
return {
realHours: 0,
effHours: 0,
bmrPerHour: getBmrPerHour(),
totalCaloriesBurned: 0,
fatLossGrams: 0
};
}
const now = Date.now();
const elapsedMs = now - state.startTime;
const elapsedHours = Math.max(0, elapsedMs / 3600000);
const realHours = elapsedHours + (state.manualOffsetHours || 0);
const bmrPerHour = getBmrPerHour();
let sportBonusHours = 0;
let refeedPenaltyHours = 0;
if (bmrPerHour && bmrPerHour > 0) {
sportBonusHours = state.totalActivityCalories / bmrPerHour;
refeedPenaltyHours = (state.totalRefeedCalories / bmrPerHour) * 2;
}
let effHours = realHours + sportBonusHours - refeedPenaltyHours;
if (!isFinite(effHours) || effHours < 0) effHours = 0;

let totalCaloriesBurned = 0;
if (bmrPerHour && bmrPerHour > 0) {
totalCaloriesBurned =
realHours * bmrPerHour +
state.totalActivityCalories -
state.totalRefeedCalories;
}
let fatLossKg = 0;
if (totalCaloriesBurned > 0) fatLossKg = totalCaloriesBurned / 7700;
const fatLossGrams = Math.max(0, fatLossKg * 1000);

return { realHours, effHours, bmrPerHour, totalCaloriesBurned, fatLossGrams };
}

function updateUI() {
updateProfileUI();
const { realHours, effHours, fatLossGrams } = computeTimes();

realTimerEl.textContent = formatHmsFromHours(realHours);
effectiveTimerEl.textContent = formatHmsFromHours(effHours);
effectiveHoursLabelEl.textContent = effHours.toFixed(1);
realHoursLabelEl.textContent = realHours.toFixed(1);
weightLossGramsEl.textContent = fatLossGrams.toFixed(0);

const phase = getPhaseInfo(effHours);
phaseTagEl.textContent = phase.tag;
phaseTitleEl.textContent = phase.title;
phaseEmojiEl.textContent = phase.emoji;
phaseShortEl.textContent = phase.short;

const p = Math.max(0, Math.min(1, phase.progress));
phaseBarFillEl.style.transform = `scaleX(${1 - p})`;
phaseMarkerEl.style.left = `${p * 100}%`;

const targetOptimal = 20;
if (effHours < targetOptimal) {
const diff = targetOptimal - effHours;
timeToOptimalLabelEl.textContent = diff.toFixed(1) + " t til optimal";
} else {
timeToOptimalLabelEl.textContent = "Over optimal zone";
}

const mix = getFuelMix(effHours);
carbPercentEl.textContent = mix.carb + "%";
fatPercentEl.textContent = mix.fat + "%";
musclePercentEl.textContent = mix.muscle + "%";
bonePercentEl.textContent = mix.bone + "%";

const medal = getMedal(effHours);
medalEmojiEl.textContent = medal.emoji;
medalTitleEl.textContent = medal.title;

if (effHours >= 16) {
autofagiTagEl.style.display = "inline-flex";
} else {
autofagiTagEl.style.display = "none";
}

// Speedometer: 0h = lav, 20h = max, efter 20h holder vi n√•len i det r√∏de omr√•de.
let clampedEff = Math.max(0, Math.min(20, effHours));
const deg = -90 + (clampedEff / 20) * 180; // -90 til +90
speedNeedleEl.style.transform = `rotate(${deg}deg)`;

if (effHours < 6) {
speedTextEl.textContent = "Lav faste-hastighed";
} else if (effHours < 14) {
speedTextEl.textContent = "Middel hastighed";
} else if (effHours < 22) {
speedTextEl.textContent = "Max fedtforbr√¶nding (model)";
} else {
speedTextEl.textContent = "Aftagende fordel (model)";
}
}

function startTimerLoop() {
if (timerId != null) clearInterval(timerId);
timerId = setInterval(updateUI, 1000);
updateUI();
}

function stopTimerLoop() {
if (timerId != null) {
clearInterval(timerId);
timerId = null;
}
}

function onProfileChange() {
state.profile.ageGroup = ageGroupEl.value;
state.profile.gender = genderEl.value;
state.profile.muscleLevel = muscleLevelEl.value;
const w = parseFloat(weightEl.value);
state.profile.weight = isNaN(w) ? null : w;
saveState();
updateUI();
}

ageGroupEl.addEventListener("change", onProfileChange);
genderEl.addEventListener("change", onProfileChange);
muscleLevelEl.addEventListener("change", onProfileChange);
weightEl.addEventListener("input", onProfileChange);

startBtnEl.addEventListener("click", () => {
if (!state.startTime) {
const pre = parseFloat(preHoursEl.value);
state.manualOffsetHours = isNaN(pre) ? 0 : Math.max(0, pre);
state.startTime = Date.now();
} else {
const pre = parseFloat(preHoursEl.value);
if (!isNaN(pre) && pre > 0) {
state.manualOffsetHours += pre;
preHoursEl.value = "";
}
}
state.isRunning = true;
saveState();
startTimerLoop();
});

resetBtnEl.addEventListener("click", () => {
if (!confirm("Nulstil fasen helt?")) return;
stopTimerLoop();
state.startTime = null;
state.manualOffsetHours = 0;
state.isRunning = false;
state.totalActivityCalories = 0;
state.totalRefeedCalories = 0;
saveState();
preHoursEl.value = "";
activityCaloriesEl.value = "";
refeedCaloriesEl.value = "";
updateUI();
});

addActivityBtnEl.addEventListener("click", () => {
const val = parseFloat(activityCaloriesEl.value);
if (isNaN(val) || val <= 0) {
alert("Skriv et antal kalorier fra sport f√∏rst.");
return;
}
state.totalActivityCalories += val;
activityCaloriesEl.value = "";
saveState();
updateUI();
});

applyRefeedBtnEl.addEventListener("click", () => {
const val = parseFloat(refeedCaloriesEl.value);
if (isNaN(val) || val <= 0) {
alert("Skriv et kalorie-anslag for m√•ltidet.");
return;
}
state.totalRefeedCalories += val;
refeedCaloriesEl.value = "";
saveState();
updateUI();
});

loadState();
updateProfileUI();
if (state.startTime && state.isRunning) {
startTimerLoop();
} else {
updateUI();
}
</script>
</body>
</html>
